<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutora - Online Tutoring</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container" id="loginContainer">
        <h1>Welcome to Tutora</h1>
        <p>Login or Sign Up</p>
        <input type="email" id="email" placeholder="Enter Email">
        <input type="text" id="firstName" placeholder="Enter First Name">
        <input type="text" id="lastName" placeholder="Enter Last Name">
        <input type="password" id="password" placeholder="Enter Password">
        <select id="userType">
            <option value="tutor">Tutor</option>
            <option value="student">Parent/Student</option>
        </select>
        <button id="loginBtn">Log In</button>
        <button id="signUpBtn">Sign Up</button>
        <p id="errorMessage" style="color: red;"></p>
    </div>

    <!-- Firebase SDK (Modules) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCmzDsxlhQwMZTlpnPlVLRRVxDQZwKW6zI",
            authDomain: "tutora-93be2.firebaseapp.com",
            projectId: "tutora-93be2",
            storageBucket: "tutora-93be2.firebaseapp.com",
            messagingSenderId: "538400859458",
            appId: "1:538400859458:web:1c45fe0364821442d854db",
            measurementId: "G-SJ9FDWTHED"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Login Event Listener
        document.getElementById("loginBtn").addEventListener("click", async function() {
            let email = document.getElementById("email").value;
            let password = document.getElementById("password").value;
            let userType = document.getElementById("userType").value;
            let errorMessage = document.getElementById("errorMessage");
            errorMessage.textContent = "";

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                let user = userCredential.user;

                // Fetch user details from Firestore
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    localStorage.setItem("firstName", userData.firstName || "Unknown");
                    localStorage.setItem("lastName", userData.lastName || "User");
                    localStorage.setItem("userEmail", user.email);
                    localStorage.setItem("userType", userType);
                    
                    window.location.href = (userType === "tutor") ? "tutor-dashboard.html" : "student-dashboard.html";
                } else {
                    errorMessage.textContent = "User data not found!";
                }
            } catch (error) {
                errorMessage.textContent = error.message;
            }
        });

        // Sign-up Event Listener
        document.getElementById("signUpBtn").addEventListener("click", async function() {
            let email = document.getElementById("email").value;
            let firstName = document.getElementById("firstName").value;
            let lastName = document.getElementById("lastName").value;
            let password = document.getElementById("password").value;
            let userType = document.getElementById("userType").value;
            let errorMessage = document.getElementById("errorMessage");
            errorMessage.textContent = "";

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                let user = userCredential.user;

                // Store user details in Firestore
                await setDoc(doc(db, "users", user.uid), {
                    firstName: firstName,
                    lastName: lastName,
                    email: email,
                    userType: userType
                });

                // Store locally & redirect
                localStorage.setItem("userEmail", user.email);
                localStorage.setItem("firstName", firstName);
                localStorage.setItem("lastName", lastName);
                localStorage.setItem("userType", userType);
                
                window.location.href = (userType === "tutor") ? "tutor-dashboard.html" : "student-dashboard.html";
            } catch (error) {
                errorMessage.textContent = error.message;
            }
        });
    </script>
</body>
</html>
